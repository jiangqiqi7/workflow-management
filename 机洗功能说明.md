# 机洗功能说明

## 功能概述
系统新增了机洗模式的判断和显示功能。根据后端返回的步骤数据中的 `sequence_no` 自动判断当前任务是普通清洗模式还是机洗模式。

## 判断逻辑

### 机洗模式判断条件
- 前两步（测漏、清洗）的 `sequence_no` 分别为 `1`、`2`
- 如果清洗（`sequence_no: '2'`）的下一步 `sequence_no` 为 `3`，则为**普通清洗模式**
- 如果清洗（`sequence_no: '2'`）的下一步 `sequence_no` 为 `7`，则为**机洗模式**

### 普通清洗模式
步骤顺序：
1. 测漏 (sequence_no: '1')
2. 清洗 (sequence_no: '2')
3. 漂洗 (sequence_no: '3')
4. 消毒 (sequence_no: '4')
5. 终末漂洗 (sequence_no: '5')
6. 干燥 (sequence_no: '6')

### 机洗模式
步骤顺序（共3步）：
1. 测漏 (sequence_no: '1')
2. 清洗 (sequence_no: '2')
3. 进入机洗 (sequence_no: '7') - **直接进入机洗，跳过漂洗步骤**

## 功能实现

### 1. 步骤显示
- **初始状态**：进度条显示所有6个步骤（测漏、清洗、漂洗、消毒、终末漂洗、干燥）
- **机洗模式**：只显示3个步骤（测漏、清洗、进入机洗），跳过漂洗步骤

### 2. 计时功能
- **普通模式**：每个步骤独立计时
- **机洗模式**：机洗步骤作为一个整体计时

### 3. 涉及文件

#### ListSteps.vue
列表页面的步骤显示组件
- 新增 `isMachineWash` 计算属性：判断是否为机洗模式
- 更新 `normalizedSteps` 计算属性：根据机洗模式动态调整步骤显示

#### WorkflowSteps.vue
详情页面的步骤显示组件
- 新增 `isMachineWash` 计算属性
- 更新 `normalizedSteps` 计算属性：支持机洗模式的步骤显示

#### WorkflowList.vue
工作流列表页面
- 新增 `STEP_NAMES_BY_SEQ` 常量：步骤序号到名称的映射
- 新增 `isMachineWash` 函数：判断是否为机洗模式
- 更新 `getStepName` 函数：支持机洗步骤名称的获取

## 数据示例

### 普通清洗模式数据
```javascript
{
  id: '001',
  userName: '李明',
  endoscopeId: 'AL4876',
  steps: [
    { step_type: 'leak_test', status: 'finished', sequence_no: '1' },
    { step_type: 'cleaning', status: 'finished', sequence_no: '2' },
    { step_type: 'rinsing', status: 'finished', sequence_no: '3' },
    { step_type: 'disfection', status: 'doing', sequence_no: '4' },
    { step_type: 'final_rinsing', status: 'pending', sequence_no: '5' },
    { step_type: 'drying', status: 'pending', sequence_no: '6' }
  ],
  currentStep: '4',
  stepStartTime: '2026-01-17T10:00:00.000Z'
}
```

### 机洗模式数据
```javascript
{
  id: '002',
  userName: '张华',
  endoscopeId: 'BL5923',
  steps: [
    { step_type: 'leak_test', status: 'finished', sequence_no: '1' },
    { step_type: 'cleaning', status: 'finished', sequence_no: '2' },
    { step_type: 'machine_wash', status: 'doing', sequence_no: '7' }
  ],
  currentStep: '7',
  stepStartTime: '2026-01-17T10:15:00.000Z'
}
```

## 测试

### 查看效果
1. 启动开发服务器：`npm run dev`
2. 访问工作流列表页面
3. 查看模拟数据中的机洗任务（如"张华（机洗）"、"赵磊（机洗）"）
4. 验证：
   - 只显示三个步骤：测漏、清洗、进入机洗
   - 没有漂洗步骤
   - 计时器显示"进入机洗"步骤名称

### 模拟数据位置
- `src/views/WorkflowList.vue` 的 `loadMockData()` 函数中包含机洗模式的测试数据
- `src/mock/data.js` 中新增了 `mockMachineWashData` 和 `mockNormalWashData` 示例数据

## 注意事项
1. 步骤的 `sequence_no` 应该是字符串类型
2. 机洗模式的 `sequence_no` 必须是 `'7'`
3. 前两步的 `sequence_no` 必须是 `'1'`、`'2'`
4. 机洗模式下不包含 `sequence_no: '3'` 的漂洗步骤
5. 系统会自动根据 `sequence_no` 判断是否为机洗模式，无需额外配置
