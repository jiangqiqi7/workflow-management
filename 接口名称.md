## **1.** **接口名称**

**get_current_workspace_information**
 获取当前洗消工作台的完整信息，包括基础信息、步骤信息、提示信息和操作记录列表。

## **2.** **接口说明**

本接口用于提供当前洗消任务（clean_task）的实时信息。
 AI 识别服务器或前端系统可以定期调用该接口，以获取当前工作台所处步骤、相关内镜信息、执行人员、告警提示等业务状态。

该接口仅在存在状态为 **“doing”** 的清洗任务时返回有效信息。

## **3.** **请求方式**

**HTTP Method****：****GET**

**请求** **URL****：**

http:`/`/116.204.65.72:8881/gdmp/v1/api/nt/get`_current_workspace_information`

## **4.** **输入参数**

此接口为 GET 请求，无需传递任何参数。

## **5.** **业务逻辑概述**

系统将按以下顺序查询数据：

### **5.1** **当前正在进行的清洗任务**

从 clean_task 表中查找 status = “doing” 的任务。

若不存在：返回“当前没有正在进行的任务”。

### **5.2** **基础信息（来自镜子表、床旁管理表）**

依据 clean_task 中的 endoscope_id 查询：

#### **镜子表（表名：镜子表）**

返回字段：endoscope_id（内镜编号）

model（型号）

manufacturer（厂商）

status（物理状态）

total_wash_count（清洗次数）

#### **床旁管理表（表名：床旁管理）**

依据字段“内镜编号”查询，返回：

姓名

科室

床号（字段名均为中文）

若床旁管理表无对应记录，则返回 null。

### **5.3** **当前步骤信息（来自 clean_step）**

根据 task_id 查询 clean_step 表（通常 4 条）。

找出 status = "doing" 的步骤，返回：

sequence_no（步骤序号）

step_type（步骤类型）

device_id（设备标识）

operator_id（执行人）

start_time（开始时间）

end_time（结束时间）

status（状态）

同时返回所有步骤组成的操作记录列表。

### **5.4** **提示信息（来自 clean_alarm）**

以 task_id 查询 clean_alarm 表：

若存在告警：

返回第一条告警记录的 message、alarm_level

若不存在：

返回 “最近没有告警提醒”

## **6.** **返回参数**

### **6.1** **成功返回示例**

{``

` `"code":` `200,``

` `"base_info":` `{``

`  `"endoscope_id":` `"END12345",``

`  `"model":` `"HQ-290",``

`  `"manufacturer":` `"OLYMPUS",``

`  `"status":` `"待清洗",``

`  `"total_wash_count":` `132,``

`  `"patient_name":` `"张三",``

`  `"department":` `"消化内科",``

`  `"bed_no":` `"12B"``

` `},``

` `"current_step":` `{``

`  `"sequence_no":` `"1",``

`  `"step_type":` `"leak_test",``

`  `"device_id":` `"172.16.77.11",``

`  `"operator_id":` `"OP1002",``

`  `"start_time":` `"2025-02-16 14:20:15",``

`  `"end_time":` `null,``

`  `"status":` `"doing"``

` `},``

` `"alarm_message":` `"水压异常，请检查接口",``

` `"step_records":` `[``

`  `{``

`   `"sequence_no":` `"1",``

`   `"step_type":` `"leak_test",``

`   `"device_id":` `"172.16.77.11",``

`   `"operator_id":` `"OP1002",``

`   `"start_time":` `"2025-02-16 14:20:15",``

`   `"end_time":` `null,``

`   `"status":` `"doing"``

`  `},``

`  `{``

`   `"sequence_no":` `"2",``

`   `"step_type":` `"wash",``

`   `"device_id":` `"",``

`   `"operator_id":` `"",``

`   `"start_time":` `null,``

`   `"end_time":` `null,``

`   `"status":` `"waiting"``

`  `},``

`  `{``

`   `"sequence_no":` `"3",``

`   `"step_type":` `"rinse",``

`   `"device_id":` `"",``

`   `"operator_id":` `"",``

`   `"start_time":` `null,``

`   `"end_time":` `null,``

`   `"status":` `"waiting"``

`  `},``

`  `{``

`   `"sequence_no":` `"4",``

`   `"step_type":` `"disinfect",``

`   `"device_id":` `"",``

`   `"operator_id":` `"",``

`   `"start_time":` `null,``

`   `"end_time":` `null,``

`   `"status":` `"waiting"``

`  `}``

` `]}

 

### **6.2** **无正在进行任务时**

{``

` `"code":` `200,``

` `"message":` `"当前没有正在进行的任务"}

 

### **6.3** **服务器错误示例**

{``

` `"code":` `500,``

` `"message":` `"服务器内部错误",``

` `"error":` `"xxx"}

 

## **7.** **错误码说明**

| **code** | **含义**                       |
| -------- | ------------------------------ |
| 200      | 正常返回（无论是否有任务）     |
| 400      | 参数不正确（此接口不会出现）   |
| 500      | 服务器内部错误、数据库查询异常 |

 

## **8.** **注意事项**

clean_task 表中任何时刻只能有一条记录处于 “doing”。

若清洗任务因超过时限（如 2 小时）自动过期，status 会自动更新为 expired，不会被本接口返回。

clean_step 的步骤信息按照 sequence_no 排序返回。

若床旁管理表中没有记录，则相关字段返回 null。

alarm_message 若没有告警，返回默认文本。